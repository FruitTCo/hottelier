{% extends 'base.html' %} {% block title %}Booking{% endblock %} {% block
content %}

<!-- Page Header Start -->
<div
  class="container-fluid page-header mb-5 p-0"
  style="background-image: url(../static/img/carousel-1.jpg)"
>
  <div class="container-fluid page-header-inner py-5">
    <div class="container text-center pb-5">
      <h1 class="display-3 text-white mb-3 animated slideInDown">Booking</h1>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb justify-content-center text-uppercase">
          <li class="breadcrumb-item"><a href="index.html">Home</a></li>
          <li class="breadcrumb-item"><a href="#">Pages</a></li>
          <li class="breadcrumb-item text-white active" aria-current="page">
            Booking
          </li>
        </ol>
      </nav>
    </div>
  </div>
</div>
<!-- Page Header End -->

<!-- Booking Start -->
<div class="container-fluid booking pb-5 wow fadeIn" data-wow-delay="0.1s">
  <div class="container">
    <div class="bg-white shadow" style="padding: 35px">
      <div class="row g-2">
        <div class="col-md-10">
          <div class="row g-2">
            <div class="col-md-3">
              <div class="date" id="date1" data-target-input="nearest">
                <input
                  type="text"
                  class="form-control datetimepicker-input"
                  placeholder="Check in"
                  data-target="#date1"
                  data-toggle="datetimepicker"
                />
              </div>
            </div>
            <div class="col-md-3">
              <div class="date" id="date2" data-target-input="nearest">
                <input
                  type="text"
                  class="form-control datetimepicker-input"
                  placeholder="Check out"
                  data-target="#date2"
                  data-toggle="datetimepicker"
                />
              </div>
            </div>
            <div class="col-md-3">
              <select class="form-select">
                <option selected>Adult</option>
                <option value="1">Adult 1</option>
                <option value="2">Adult 2</option>
                <option value="3">Adult 3</option>
              </select>
            </div>
            <div class="col-md-3">
              <select class="form-select">
                <option selected>Child</option>
                <option value="1">Child 1</option>
                <option value="2">Child 2</option>
                <option value="3">Child 3</option>
              </select>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <button class="btn btn-primary w-100">Submit</button>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Booking End -->

<!-- Booking Start -->
<div class="container-xxl py-5">
  <div class="container">
    <div class="text-center wow fadeInUp" data-wow-delay="0.1s">
      <h6 class="section-title text-center text-primary text-uppercase">
        Room Booking
      </h6>
      <h1 class="mb-5">
        Book A <span class="text-primary text-uppercase">Luxury Room</span>
      </h1>
    </div>
    <div class="row g-5">
      <div class="col-lg-6">
        <div class="row g-3">
          <div class="col-6 text-end">
            <img
              class="img-fluid rounded w-75 wow zoomIn"
              data-wow-delay="0.1s"
              src="{{ url_for('static', filename='img/about-1.jpg') }}"
              style="margin-top: 25%"
            />
          </div>
          <div class="col-6 text-start">
            <img
              class="img-fluid rounded w-100 wow zoomIn"
              data-wow-delay="0.3s"
              src="{{ url_for('static', filename='img/about-2.jpg') }}"
            />
          </div>
          <div class="col-6 text-end">
            <img
              class="img-fluid rounded w-50 wow zoomIn"
              data-wow-delay="0.5s"
              src="{{ url_for('static', filename='img/about-3.jpg') }}"
            />
          </div>
          <div class="col-6 text-start">
            <img
              class="img-fluid rounded w-75 wow zoomIn"
              data-wow-delay="0.7s"
              src="{{ url_for('static', filename='img/about-4.jpg') }}"
            />
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="wow fadeInUp" data-wow-delay="0.2s">
          <form id="paymentForm">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="name"
                    name="name"
                    placeholder="Your Name"
                    required
                  />
                  <label for="name">Your Name</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    name="email"
                    placeholder="Your Email"
                    required
                  />
                  <label for="email">Your Email</label>
                </div>
              </div>
              <div class="col-md-6">
                <div
                  class="form-floating date"
                  id="date3"
                  data-target-input="nearest"
                >
                  <input
                    type="datetime"
                    class="form-control datetimepicker-input"
                    id="checkin"
                    name="checkin"
                    placeholder="Check In"
                    data-target="#date3"
                    data-toggle="datetimepicker"
                    required
                  />
                  <label for="checkin">Check In</label>
                </div>
              </div>
              <div class="col-md-6">
                <div
                  class="form-floating date"
                  id="date4"
                  data-target-input="nearest"
                >
                  <input
                    type="datetime"
                    class="form-control datetimepicker-input"
                    id="checkout"
                    name="checkout"
                    placeholder="Check Out"
                    data-target="#date4"
                    data-toggle="datetimepicker"
                    required
                  />
                  <label for="checkout">Check Out</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-floating">
                  <select class="form-select" id="select1" name="select1" required>
                    <option value="1">Adult 1</option>
                    <option value="2">Adult 2</option>
                    <option value="3">Adult 3</option>
                  </select>
                  <label for="select1">Select Adult</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-floating">
                  <select class="form-select" id="select2" name="select2" required>
                    <option value="1">Child 1</option>
                    <option value="2">Child 2</option>
                    <option value="3">Child 3</option>
                  </select>
                  <label for="select2">Select Child</label>
                </div>
              </div>
              <div class="col-12">
                <div class="form-floating">
                  <select class="form-select" id="select3" name="select3" required>
                    <option value="200" data-suite="Junior Suite">Junior Suite</option>
                    <option value="300" data-suite="Executive Suite">Executive Suite</option>
                    <option value="400" data-suite="Super Deluxe">Super Deluxe</option>
                  </select>
                  <label for="select3">Select A Room</label>
                </div>
              </div>
              <div class="col-12">
                <div class="form-floating">
                  <textarea
                    class="form-control"
                    placeholder="Special Request"
                    id="message"
                    name="message"
                    style="height: 100px"
                  ></textarea>
                  <label for="message">Special Request</label>
                </div>
              </div>
              <div class="col-12">
                <button
                  class="btn btn-success w-100 py-3 launch"
                  type="button"
                  data-toggle="modal"
                  data-target="#staticBackdrop"
                  onclick="payWithPaystack()"
                >
                  Pay Now
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Booking End -->

{% block js %}
<script src="https://js.paystack.co/v1/inline.js"></script>

<script src="{{ url_for('static', filename='js/pay.js') }}"></script>

{#
<script>
  function payWithPaystack() {
    console.log("{{ config['PAYSTACK_PUBLIC_KEY'] }}");
  }
</script>
#}

<script
  src="https://code.jquery.com/jquery-3.5.1.js"
  integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
  crossorigin="anonymous"
></script>

<script type="text/javascript">
  document
    .querySelector(document)
    .addEventListener("submit", "#paymentForm", function (e) {
      console.log("hello");
      e.preventDefault();
    });

  // payment
  // var paymentForm = document.getElementById("paymentForm");

  // paymentForm.addEventListener("submit", payWithPaystack, false);

  function payWithPaystack() {
    var handler = PaystackPop.setup({
      key: "{{ config['PAYSTACK_PUBLIC_KEY'] }}", // Replace with your public key

      email: document.getElementById("email").value,

      

      amount: document.getElementById("select3").value * 100, // the amount value is multiplied by 100 to convert to the lowest currency unit

      currency: "NGN", // Use GHS for Ghana Cedis or USD for US Dollars

      ref: '{{ id }}', // Replace with a reference you generated

      callback: function (response) {
        //this happens after the payment is completed successfully

        // Make an AJAX call to your server with the reference to verify the transaction
        $.ajax({
          type: "POST",
          url: "{{ url_for('booking') }}",
          data: {
            name: document.querySelector("#name").value,
            email: document.querySelector("#email").value,
            check_in: document.querySelector("#checkin").value,
            check_out: document.querySelector("#checkout").value,
            Adult: document.querySelector("#select1").value,
            Child: document.querySelector("#select2").value,
            suite: document.querySelector("#select3").value,
            message: document.querySelector("#message").value,
            ref: '{{ id }}',
            status: 'success'
          },
          success: function () {
            window.location.href = '{{ url_for("root") }}';
          },
        }); 
      },

      onClose: function () {
        alert("Transaction was not completed, window closed.");
        $.ajax({
          type: "POST",
          url: "{{ url_for('booking') }}",
          data: {
            name: document.querySelector("#name").value,
            email: document.querySelector("#email").value,
            check_in: document.querySelector("#checkin").value,
            check_out: document.querySelector("#checkout").value,
            Adult: document.querySelector("#select1").value,
            Child: document.querySelector("#select2").value,
            suite: document.querySelector("#select3").value,
            message: document.querySelector("#message").value,
            ref: '{{ id }}',
            status: 'declined'
          },
          success: function () {
            window.location.href = '{{ url_for("booking") }}';
          },
        }); 
      },
    });

    handler.openIframe();
  }
</script>
{% endblock %} {% endblock %}
